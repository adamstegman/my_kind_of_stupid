<!DOCTYPE html>
<html>
  <head>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta content='en-us' http-equiv='Content-Language'>
    <meta content='IE=edge' http-equiv='X-UA-Compatible'>
    <meta name='keywords'>
    <meta name='description'>
    <title>Implementing a Mutable Subclass in Objective-C - My Kind of Stupid</title>
    <link href='/feed.xml' rel='alternate' title='Articles' type='application/atom+xml'>
    <link href='/favicon.ico' rel='icon' type='image/vnd.microsoft.icon'>
    <link href='/stylesheets/application.css' rel='stylesheet' type='text/css'>
  </head>
  <body>
    <header>
      <div class='container'>
        <hgroup>
          <h1>
            <a class='title' href='/'>My Kind of Stupid</a>
          </h1>
          <h2>Web development, user interfaces, and other development topics.</h2>
        </hgroup>
        <nav>
          <ul class='nav-list'>
            <li>
              <a href='/'>Articles</a>
            </li>
            <li>
              <a href='http://adamstegman.com/'>Adam Stegman</a>
            </li>
            <li>
              <a href='http://twitter.com/adamstegman' rel='me'>Twitter</a>
            </li>
            <li>
              <a href='http://github.com/adamstegman' rel='me'>Github</a>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <div class='content'>
      <div class='container'>
        <article itemscope itemtype='http://www.schema.org/BlogPosting'>
          <header>
            <hgroup>
              <h2 itemprop='name'>Implementing a Mutable Subclass in Objective-C</h2>
            </hgroup>
          </header>
          <div class='article-body' itemprop='articleBody'>
            <p>I&#8217;m writing a class in <a href='http://adamstegman.com/projects/git-push.html'>Git Push</a> to hold and fetch git blobs from <a href='http://developer.github.com/v3/git/blobs/'>Github</a>.</p>&#x000A;&#x000A;<pre><code>@interface GHBlob : NSObject &lt;NSCopying, NSMutableCopying&gt;&#x000A;@property (nonatomic, copy, readonly) NSData *content;&#x000A;...&#x000A;@end&#x000A;&#x000A;@implementation GHBlob&#x000A;@synthesize content = _content;&#x000A;...&#x000A;@end</code></pre>&#x000A;&#x000A;<p>To support creating and updating blobs, I wrote a mutable subclass initialized in #mutableCopy from <a href='http://developer.apple.com/library/ios/#documentation/Cocoa/Reference/Foundation/Protocols/NSMutableCopying_Protocol/Reference/Reference.html#//apple_ref/occ/intf/NSMutableCopying'>NSMutableCopying</a>. This entailed redefining properties as <code>readwrite</code>:</p>&#x000A;&#x000A;<pre><code>@interface GHMutableBlob : GHBlob&#x000A;@property (nonatomic, copy, readwrite) NSData *content;&#x000A;...&#x000A;@end&#x000A;&#x000A;@implementation GHMutableBlob&#x000A;@synthesize content = _content;&#x000A;...&#x000A;@end</code></pre>&#x000A;&#x000A;<h3 id='problems'>Problems</h3>&#x000A;&#x000A;<h4 id='resynthesizing'>Resynthesizing</h4>&#x000A;&#x000A;<p>As shown above, I also re-synthesized the methods in the subclass. However, this resulted in the subclass&#8217;s initializer breaking.</p>&#x000A;&#x000A;<pre><code>GHBlob *newBlob = [blob mutableCopy];&#x000A;STAssertEquals(newBlob.content, blob.content, nil);&#x000A;  //=&gt; &#39;&lt;00000000&gt;&#39; should be equal to &#39;&lt;10cbb806&gt;&#39;</code></pre>&#x000A;&#x000A;<p>On review, I noticed something I&#8217;d missed before in <a href='http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Chapters/ocProperties.html'>Apple&#8217;s documentation on redeclaring properties</a>. The redeclared property isn&#8217;t synthesized in their example, it&#8217;s declared <code>@dynamic</code> and the setter is defined by hand. I scoffed at the inconvenience (isn&#8217;t this what synthesizing is supposed to avoid?), but did it anyway.</p>&#x000A;&#x000A;<h4 id='unreachable_instance_variables'>Unreachable instance variables</h4>&#x000A;&#x000A;<p>Next, the compiler complained that the <code>_content</code> instance variable was unreachable. Oh, <a href='http://stackoverflow.com/questions/5015130/do-properties-have-to-be-declared-as-instance-variables-in-objective-c#answer-5015657'>so <em>this</em> is why we define ivars in the interface</a> - it makes them available to subclasses.</p>&#x000A;&#x000A;<h3 id='summary'>Summary</h3>&#x000A;&#x000A;<p>So to implement <code>NSMutableCopying</code>, I had to explicitly declare my instance variables in the interface and explicitly define setter methods in my mutable subclass. I thought the property/synthesize syntax was <a href='http://mobile.dzone.com/news/open-letter-apple-please-kill'>saving me the trouble</a>, but apparently it&#8217;s not all rainbows and unicorns.</p>&#x000A;&#x000A;<pre><code>@interface GHBlob : NSObject &lt;NSCopying, NSMutableCopying&gt; {&#x000A;  NSData *_content;&#x000A;}&#x000A;@property (nonatomic, copy, readonly) NSData *content;&#x000A;...&#x000A;@end&#x000A;&#x000A;@implementation GHBlob&#x000A;@synthesize content = _content;&#x000A;@end</code></pre>&#x000A;&#x000A;<p>And in the mutable subclass:</p>&#x000A;&#x000A;<pre><code>@interface GHMutableBlob : GHBlob&#x000A;@property (nonatomic, copy, readwrite) NSData *content;&#x000A;...&#x000A;@end&#x000A;&#x000A;@implementation GHMutableBlob&#x000A;@dynamic content;&#x000A;- (void)setContent:(NSData *)content {&#x000A;  _content = [content copy];&#x000A;}</code></pre>
          </div>
          <footer>
            <div class='published'>
              Published at
              <time datetime='2012-01-06T06:31Z' itemprop='datePublished' pubdate>January 6, 2012 12:31am</time>
            </div>
          </footer>
        </article>
      </div>
    </div>
    <footer>
      <div class='container'>
        <section class='author'>
          <h2>
            Written by
            <a href='http://adamstegman.com/' rel='author'>Adam Stegman</a>
          </h2>
          <ul class='contact'>
            <li>
              <a href='http://twitter.com/adamstegman'>Follow me on Twitter</a>
            </li>
            <li>
              <a href='http://github.com/adamstegman'>Follow me on Github</a>
            </li>
            <li>
              <a href='http://profiles.google.com/adam.stegman'>Google Profile</a>
            </li>
            <li>
              <a href='mailto:me@adamstegman.com'>Email me</a>
            </li>
          </ul>
        </section>
      </div>
    </footer>
    <script>
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-24951237-1']);
      _gaq.push(['_setDomainName', '.adamstegman.com']);
      _gaq.push(['_trackPageview']);
      
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>
