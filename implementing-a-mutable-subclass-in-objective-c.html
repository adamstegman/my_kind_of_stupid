<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta http-equiv="Content-Language" content="en-us"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="keywords" content=""/>
  <meta name="description" content=""/>
  <title>Implementing a Mutable Subclass in Objective-C - My Kind of Stupid</title>
  <link type="application/atom+xml" href="/feed.xml" rel="alternate" title="Articles"/>
  <link type="image/vnd.microsoft.icon" href="/favicon.ico" rel="icon"/>
  <link type="text/css" href="/stylesheets/application.css" rel="stylesheet"/>
  
</head>
<body>
  <header>
    <div class="container">
      <hgroup>
        <h1><a href="/" class="title">My Kind of Stupid</a></h1>
        <h2>Web development, user interfaces, and other development topics.</h2>
      </hgroup>
      <nav>
        <ul class="nav-list">
          <li><a href="/">Articles</a></li>
          <li><a href="http://adamstegman.com/">Adam Stegman</a></li>
          <li><a rel="me" href="http://twitter.com/adamstegman">Twitter</a></li>
          <li><a rel="me" href="http://github.com/adamstegman">Github</a></li>
      </nav>
    </div>
  </header>
  <div class="content">
    <div class="container">
      <article itemscope="true" itemtype="http://www.schema.org/BlogPosting">
        <header>
          <hgroup>
            
            <h2 itemprop="name">Implementing a Mutable Subclass in Objective-C</h2>
            
            
          </hgroup>
        </header>
        <div class="article-body" itemprop="articleBody">
          <p>I&#8217;m writing a class in <a href='http://adamstegman.com/projects/git-push.html'>Git Push</a> to hold and fetch git blobs from <a href='http://developer.github.com/v3/git/blobs/'>Github</a>.</p>

<pre><code>@interface GHBlob : NSObject &lt;NSCopying, NSMutableCopying&gt;
@property (nonatomic, copy, readonly) NSData *content;
...
@end

@implementation GHBlob
@synthesize content = _content;
...
@end</code></pre>

<p>To support creating and updating blobs, I wrote a mutable subclass initialized in #mutableCopy from <a href='http://developer.apple.com/library/ios/#documentation/Cocoa/Reference/Foundation/Protocols/NSMutableCopying_Protocol/Reference/Reference.html#//apple_ref/occ/intf/NSMutableCopying'>NSMutableCopying</a>. This entailed redefining properties as <code>readwrite</code>:</p>

<pre><code>@interface GHMutableBlob : GHBlob
@property (nonatomic, copy, readwrite) NSData *content;
...
@end

@implementation GHMutableBlob
@synthesize content = _content;
...
@end</code></pre>

<h3 id='problems'>Problems</h3>

<h4 id='resynthesizing'>Resynthesizing</h4>

<p>As shown above, I also re-synthesized the methods in the subclass. However, this resulted in the subclass&#8217;s initializer breaking.</p>

<pre><code>GHBlob *newBlob = [blob mutableCopy];
STAssertEquals(newBlob.content, blob.content, nil);
  //=&gt; &#39;&lt;00000000&gt;&#39; should be equal to &#39;&lt;10cbb806&gt;&#39;</code></pre>

<p>On review, I noticed something I&#8217;d missed before in <a href='http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/ObjectiveC/Chapters/ocProperties.html'>Apple&#8217;s documentation on redeclaring properties</a>. The redeclared property isn&#8217;t synthesized in their example, it&#8217;s declared <code>@dynamic</code> and the setter is defined by hand. I scoffed at the inconvenience (isn&#8217;t this what synthesizing is supposed to avoid?), but did it anyway.</p>

<h4 id='unreachable_instance_variables'>Unreachable instance variables</h4>

<p>Next, the compiler complained that the <code>_content</code> instance variable was unreachable. Oh, <a href='http://stackoverflow.com/questions/5015130/do-properties-have-to-be-declared-as-instance-variables-in-objective-c#answer-5015657'>so <em>this</em> is why we define ivars in the interface</a> - it makes them available to subclasses.</p>

<h3 id='summary'>Summary</h3>

<p>So to implement <code>NSMutableCopying</code>, I had to explicitly declare my instance variables in the interface and explicitly define setter methods in my mutable subclass. I thought the property/synthesize syntax was <a href='http://mobile.dzone.com/news/open-letter-apple-please-kill'>saving me the trouble</a>, but apparently it&#8217;s not all rainbows and unicorns.</p>

<pre><code>@interface GHBlob : NSObject &lt;NSCopying, NSMutableCopying&gt; {
  NSData *_content;
}
@property (nonatomic, copy, readonly) NSData *content;
...
@end

@implementation GHBlob
@synthesize content = _content;
@end</code></pre>

<p>And in the mutable subclass:</p>

<pre><code>@interface GHMutableBlob : GHBlob
@property (nonatomic, copy, readwrite) NSData *content;
...
@end

@implementation GHMutableBlob
@dynamic content;
- (void)setContent:(NSData *)content {
  _content = [content copy];
}</code></pre>
        </div>
        <footer>
          <div class="published">
            Published at
            <time datetime="2012-01-06T06:31Z" pubdate="true" itemprop="datePublished">
              January 6, 2012 12:31am
            </time>
          </div>
        </footer>
      </article>
    </div>
  </div>
  <footer>
    <div class="container">
      <section class="author">
        <h2>
          Written by
          <a rel="author" href="http://adamstegman.com/">Adam Stegman</a>
        </h2>
        <ul class="contact">
          <li>
            <a href="http://twitter.com/adamstegman">Follow me on Twitter</a>
          </li>
          <li>
            <a href="http://github.com/adamstegman">Follow me on Github</a>
          </li>
          <li>
            <a href="http://profiles.google.com/adam.stegman">Google Profile</a>
          </li>
          <li>
            <a href="mailto:me@adamstegman.com">Email me</a>
          </li>
        </ul>
      </section>
    </div>
  </footer>
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-24951237-1']);
    _gaq.push(['_setDomainName', '.adamstegman.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
</body>
</html>
